package org.mulesoft.als

import org.mulesoft.als.wasmloader.AMFValidator
import org.scalatest.AsyncFlatSpec

import scala.concurrent.ExecutionContext

class JsCustomValidationTest extends AsyncFlatSpec {

  override implicit val executionContext: ExecutionContext = ExecutionContext.Implicits.global

  behavior of "JS Custom validation"

  it should "Load the validator" in {
    AMFValidator().map(validator => {
      println(
        validator.validate(
          "#%Validation Profile 1.0\n\nprofile: Test1\n\nviolation:\n  - scalar-parameters\n\nvalidations:\n  scalar-parameters:\n    targetClass: apiContract.Parameter\n    message: Scalars in parameters must have minLength defined\n    propertyConstraints:\n      shapes.schema / shacl.minLength:\n        minCount: 1",
          "[\n  {\n    \"@id\": \"file://test/data/integration/profile1/positive.data.raml\",\n    \"@type\": [\n      \"http://a.ml/vocabularies/document#Document\",\n      \"http://a.ml/vocabularies/document#Fragment\",\n      \"http://a.ml/vocabularies/document#Module\",\n      \"http://a.ml/vocabularies/document#Unit\"\n    ],\n    \"http://a.ml/vocabularies/document#encodes\": [\n      {\n        \"@id\": \"file://test/data/integration/profile1/positive.data.raml#/web-api\",\n        \"@type\": [\n          \"http://a.ml/vocabularies/apiContract#WebAPI\",\n          \"http://a.ml/vocabularies/apiContract#API\",\n          \"http://a.ml/vocabularies/document#RootDomainElement\",\n          \"http://a.ml/vocabularies/document#DomainElement\"\n        ],\n        \"http://a.ml/vocabularies/core#name\": [\n          {\n            \"@value\": \"Test API\"\n          }\n        ],\n        \"http://a.ml/vocabularies/apiContract#endpoint\": [\n          {\n            \"@id\": \"file://test/data/integration/profile1/positive.data.raml#/web-api/end-points/%2Fendpoint1\",\n            \"@type\": [\n              \"http://a.ml/vocabularies/apiContract#EndPoint\",\n              \"http://a.ml/vocabularies/document#DomainElement\"\n            ],\n            \"http://a.ml/vocabularies/apiContract#path\": [\n              {\n                \"@value\": \"/endpoint1\"\n              }\n            ],\n            \"http://a.ml/vocabularies/apiContract#supportedOperation\": [\n              {\n                \"@id\": \"file://test/data/integration/profile1/positive.data.raml#/web-api/end-points/%2Fendpoint1/get\",\n                \"@type\": [\n                  \"http://a.ml/vocabularies/apiContract#Operation\",\n                  \"http://a.ml/vocabularies/document#DomainElement\"\n                ],\n                \"http://a.ml/vocabularies/apiContract#method\": [\n                  {\n                    \"@value\": \"get\"\n                  }\n                ],\n                \"http://a.ml/vocabularies/apiContract#expects\": [\n                  {\n                    \"@id\": \"file://test/data/integration/profile1/positive.data.raml#/web-api/end-points/%2Fendpoint1/get/request\",\n                    \"@type\": [\n                      \"http://a.ml/vocabularies/apiContract#Request\",\n                      \"http://a.ml/vocabularies/apiContract#Message\",\n                      \"http://a.ml/vocabularies/document#DomainElement\"\n                    ],\n                    \"http://a.ml/vocabularies/apiContract#parameter\": [\n                      {\n                        \"@id\": \"file://test/data/integration/profile1/positive.data.raml#/web-api/end-points/%2Fendpoint1/get/request/parameter/query/a\",\n                        \"@type\": [\n                          \"http://a.ml/vocabularies/apiContract#Parameter\",\n                          \"http://a.ml/vocabularies/document#DomainElement\"\n                        ],\n                        \"http://a.ml/vocabularies/core#name\": [\n                          {\n                            \"@value\": \"a\"\n                          }\n                        ],\n                        \"http://a.ml/vocabularies/apiContract#paramName\": [\n                          {\n                            \"@value\": \"a\"\n                          }\n                        ],\n                        \"http://a.ml/vocabularies/apiContract#required\": [\n                          {\n                            \"@value\": true\n                          }\n                        ],\n                        \"http://a.ml/vocabularies/apiContract#binding\": [\n                          {\n                            \"@value\": \"query\"\n                          }\n                        ],\n                        \"http://a.ml/vocabularies/shapes#schema\": [\n                          {\n                            \"@id\": \"file://test/data/integration/profile1/positive.data.raml#/web-api/end-points/%2Fendpoint1/get/request/parameter/default-binding/a/scalar/schema\",\n                            \"@type\": [\n                              \"http://a.ml/vocabularies/shapes#ScalarShape\",\n                              \"http://a.ml/vocabularies/shapes#AnyShape\",\n                              \"http://www.w3.org/ns/shacl#Shape\",\n                              \"http://a.ml/vocabularies/shapes#Shape\",\n                              \"http://a.ml/vocabularies/document#DomainElement\"\n                            ],\n                            \"http://www.w3.org/ns/shacl#datatype\": [\n                              {\n                                \"@id\": \"http://www.w3.org/2001/XMLSchema#string\"\n                              }\n                            ],\n                            \"http://www.w3.org/ns/shacl#minLength\": [\n                              {\n                                \"@value\": 10\n                              }\n                            ],\n                            \"http://www.w3.org/ns/shacl#name\": [\n                              {\n                                \"@value\": \"schema\"\n                              }\n                            ]\n                          }\n                        ]\n                      }\n                    ],\n                    \"http://a.ml/vocabularies/apiContract#payload\": [\n                      {\n                        \"@id\": \"file://test/data/integration/profile1/positive.data.raml#/web-api/end-points/%2Fendpoint1/get/request/application%2Fjson\",\n                        \"@type\": [\n                          \"http://a.ml/vocabularies/apiContract#Payload\",\n                          \"http://a.ml/vocabularies/document#DomainElement\"\n                        ],\n                        \"http://a.ml/vocabularies/core#mediaType\": [\n                          {\n                            \"@value\": \"application/json\"\n                          }\n                        ],\n                        \"http://a.ml/vocabularies/shapes#schema\": [\n                          {\n                            \"@id\": \"file://test/data/integration/profile1/positive.data.raml#/web-api/end-points/%2Fendpoint1/get/request/application%2Fjson/schema\",\n                            \"@type\": [\n                              \"http://www.w3.org/ns/shacl#NodeShape\",\n                              \"http://a.ml/vocabularies/shapes#AnyShape\",\n                              \"http://www.w3.org/ns/shacl#Shape\",\n                              \"http://a.ml/vocabularies/shapes#Shape\",\n                              \"http://a.ml/vocabularies/document#DomainElement\"\n                            ],\n                            \"http://www.w3.org/ns/shacl#closed\": [\n                              {\n                                \"@value\": false\n                              }\n                            ],\n                            \"http://www.w3.org/ns/shacl#property\": [\n                              {\n                                \"@id\": \"file://test/data/integration/profile1/positive.data.raml#/web-api/end-points/%2Fendpoint1/get/request/application%2Fjson/schema/property/b\",\n                                \"@type\": [\n                                  \"http://www.w3.org/ns/shacl#PropertyShape\",\n                                  \"http://www.w3.org/ns/shacl#Shape\",\n                                  \"http://a.ml/vocabularies/shapes#Shape\",\n                                  \"http://a.ml/vocabularies/document#DomainElement\"\n                                ],\n                                \"http://www.w3.org/ns/shacl#path\": [\n                                  {\n                                    \"@id\": \"http://a.ml/vocabularies/data#b\"\n                                  }\n                                ],\n                                \"http://a.ml/vocabularies/shapes#range\": [\n                                  {\n                                    \"@id\": \"file://test/data/integration/profile1/positive.data.raml#/web-api/end-points/%2Fendpoint1/get/request/application%2Fjson/schema/property/b/scalar/b\",\n                                    \"@type\": [\n                                      \"http://a.ml/vocabularies/shapes#ScalarShape\",\n                                      \"http://a.ml/vocabularies/shapes#AnyShape\",\n                                      \"http://www.w3.org/ns/shacl#Shape\",\n                                      \"http://a.ml/vocabularies/shapes#Shape\",\n                                      \"http://a.ml/vocabularies/document#DomainElement\"\n                                    ],\n                                    \"http://www.w3.org/ns/shacl#datatype\": [\n                                      {\n                                        \"@id\": \"http://www.w3.org/2001/XMLSchema#string\"\n                                      }\n                                    ],\n                                    \"http://www.w3.org/ns/shacl#minLength\": [\n                                      {\n                                        \"@value\": 5\n                                      }\n                                    ],\n                                    \"http://www.w3.org/ns/shacl#name\": [\n                                      {\n                                        \"@value\": \"b\"\n                                      }\n                                    ]\n                                  }\n                                ],\n                                \"http://www.w3.org/ns/shacl#minCount\": [\n                                  {\n                                    \"@value\": 1\n                                  }\n                                ],\n                                \"http://www.w3.org/ns/shacl#name\": [\n                                  {\n                                    \"@value\": \"b\"\n                                  }\n                                ]\n                              }\n                            ],\n                            \"http://www.w3.org/ns/shacl#name\": [\n                              {\n                                \"@value\": \"schema\"\n                              }\n                            ]\n                          }\n                        ]\n                      }\n                    ]\n                  }\n                ]\n              }\n            ]\n          },\n          {\n            \"@id\": \"file://test/data/integration/profile1/positive.data.raml#/web-api/end-points/%2Fendpoint2\",\n            \"@type\": [\n              \"http://a.ml/vocabularies/apiContract#EndPoint\",\n              \"http://a.ml/vocabularies/document#DomainElement\"\n            ],\n            \"http://a.ml/vocabularies/apiContract#path\": [\n              {\n                \"@value\": \"/endpoint2\"\n              }\n            ],\n            \"http://a.ml/vocabularies/apiContract#supportedOperation\": [\n              {\n                \"@id\": \"file://test/data/integration/profile1/positive.data.raml#/web-api/end-points/%2Fendpoint2/get\",\n                \"@type\": [\n                  \"http://a.ml/vocabularies/apiContract#Operation\",\n                  \"http://a.ml/vocabularies/document#DomainElement\"\n                ],\n                \"http://a.ml/vocabularies/apiContract#method\": [\n                  {\n                    \"@value\": \"get\"\n                  }\n                ],\n                \"http://a.ml/vocabularies/apiContract#expects\": [\n                  {\n                    \"@id\": \"file://test/data/integration/profile1/positive.data.raml#/web-api/end-points/%2Fendpoint2/get/request\",\n                    \"@type\": [\n                      \"http://a.ml/vocabularies/apiContract#Request\",\n                      \"http://a.ml/vocabularies/apiContract#Message\",\n                      \"http://a.ml/vocabularies/document#DomainElement\"\n                    ],\n                    \"http://a.ml/vocabularies/apiContract#parameter\": [\n                      {\n                        \"@id\": \"file://test/data/integration/profile1/positive.data.raml#/web-api/end-points/%2Fendpoint2/get/request/parameter/query/c\",\n                        \"@type\": [\n                          \"http://a.ml/vocabularies/apiContract#Parameter\",\n                          \"http://a.ml/vocabularies/document#DomainElement\"\n                        ],\n                        \"http://a.ml/vocabularies/core#name\": [\n                          {\n                            \"@value\": \"c\"\n                          }\n                        ],\n                        \"http://a.ml/vocabularies/apiContract#paramName\": [\n                          {\n                            \"@value\": \"c\"\n                          }\n                        ],\n                        \"http://a.ml/vocabularies/apiContract#required\": [\n                          {\n                            \"@value\": true\n                          }\n                        ],\n                        \"http://a.ml/vocabularies/apiContract#binding\": [\n                          {\n                            \"@value\": \"query\"\n                          }\n                        ],\n                        \"http://a.ml/vocabularies/shapes#schema\": [\n                          {\n                            \"@id\": \"file://test/data/integration/profile1/positive.data.raml#/web-api/end-points/%2Fendpoint2/get/request/parameter/default-binding/c/scalar/schema\",\n                            \"@type\": [\n                              \"http://a.ml/vocabularies/shapes#ScalarShape\",\n                              \"http://a.ml/vocabularies/shapes#AnyShape\",\n                              \"http://www.w3.org/ns/shacl#Shape\",\n                              \"http://a.ml/vocabularies/shapes#Shape\",\n                              \"http://a.ml/vocabularies/document#DomainElement\"\n                            ],\n                            \"http://www.w3.org/ns/shacl#datatype\": [\n                              {\n                                \"@id\": \"http://www.w3.org/2001/XMLSchema#string\"\n                              }\n                            ],\n                            \"http://www.w3.org/ns/shacl#minLength\": [\n                              {\n                                \"@value\": 5\n                              }\n                            ],\n                            \"http://www.w3.org/ns/shacl#name\": [\n                              {\n                                \"@value\": \"schema\"\n                              }\n                            ]\n                          }\n                        ]\n                      }\n                    ]\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    ],\n    \"http://a.ml/vocabularies/document#version\": [\n      {\n        \"@value\": \"2.3.0\"\n      }\n    ],\n    \"http://a.ml/vocabularies/document#root\": [\n      {\n        \"@value\": true\n      }\n    ]\n  }\n]",
          debug = false
        ))

      assert(true)
    })
  }

}
